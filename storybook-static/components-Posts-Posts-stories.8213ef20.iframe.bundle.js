(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[281],{"./src/components/Posts/Posts.stories.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:function(){return Primary},__namedExportsOrder:function(){return __namedExportsOrder},default:function(){return Posts_stories}});var _Primary$parameters,_Primary$parameters2,_Primary$parameters2$,_play,objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),regeneratorRuntime=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),dist=__webpack_require__("./node_modules/@storybook/jest/dist/index.mjs"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),http=__webpack_require__("./node_modules/msw/lib/core/http.mjs"),HttpResponse=__webpack_require__("./node_modules/msw/lib/core/HttpResponse.mjs"),browser=__webpack_require__("./node_modules/msw/lib/browser/index.mjs"),MOCKED_POSTS=[{id:1,title:"First post"},{id:2,title:"Second post"}],handlers=[http.d.get("https://simple2B.dummy/posts",(function(){return HttpResponse.Z.json(MOCKED_POSTS)})),http.d.post("https://simple2B.dummy/posts",function(){var _ref2=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(_ref){var request,newPost,id;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return request=_ref.request,_context.next=3,request.json();case 3:if((newPost=_context.sent).title){_context.next=6;break}return _context.abrupt("return",HttpResponse.Z.json(null,{status:400,headers:{"Content-Type":"application/json","X-Error-Message":"Title is required"}}));case 6:return id=MOCKED_POSTS.length+1,MOCKED_POSTS.push({id:id,title:newPost.title}),_context.abrupt("return",HttpResponse.Z.json(newPost,{status:201}));case 9:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref2.apply(this,arguments)}}()),http.d.delete("https://simple2B.dummy/posts/:id",(function(_ref3){var id=_ref3.params.id,deletedPost=MOCKED_POSTS.find((function(post){return post.id===Number(id)}));return deletedPost?(MOCKED_POSTS.splice(MOCKED_POSTS.indexOf(deletedPost),1),HttpResponse.Z.json(deletedPost,{status:200})):HttpResponse.Z.json(null,{status:404})}))],testing_library_dist=(browser.L.apply(void 0,handlers),__webpack_require__("./node_modules/@storybook/testing-library/dist/index.mjs")),meta={title:"UI/Posts",component:function Posts(){var _useState=(0,react.useState)([]),_useState2=(0,slicedToArray.Z)(_useState,2),posts=_useState2[0],setPosts=_useState2[1],_useState3=(0,react.useState)(""),_useState4=(0,slicedToArray.Z)(_useState3,2),newPostTitle=_useState4[0],setNewPostTitle=_useState4[1],_useState5=(0,react.useState)(""),_useState6=(0,slicedToArray.Z)(_useState5,2),error=_useState6[0],setError=_useState6[1];(0,react.useEffect)((function(){fetch("https://simple2B.dummy/posts").then((function(response){return response.json()})).then((function(json){return setPosts(json)}))}),[]);var deletePost=function(){var _ref=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(id){return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,fetch("https://simple2B.dummy/posts/".concat(id),{method:"DELETE"});case 2:fetch("https://simple2B.dummy/posts").then((function(response){return response.json()})).then((function(json){return setPosts(json)}));case 3:case"end":return _context.stop()}}),_callee)})));return function deletePost(_x){return _ref.apply(this,arguments)}}(),postsLayout=posts.map((function(post){return(0,jsx_runtime.jsxs)("div",{"data-testid":"post",children:[(0,jsx_runtime.jsx)("h2",{children:post.id}),(0,jsx_runtime.jsx)("p",{children:post.title}),(0,jsx_runtime.jsx)("button",{onClick:function deleteHandler(){return deletePost(post.id)},children:"Delete"})]},post.id)})),addNewPost=function(){var _ref2=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee2(){return(0,regeneratorRuntime.Z)().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.next=3,fetch("https://simple2B.dummy/posts",{method:"POST",body:JSON.stringify({title:newPostTitle})});case 3:if(400!==_context2.sent.status){_context2.next=6;break}throw new Error("Bad request");case 6:setNewPostTitle(""),fetch("https://simple2B.dummy/posts").then((function(response){return response.json()})).then((function(json){return setPosts(json)})),_context2.next=13;break;case 10:_context2.prev=10,_context2.t0=_context2.catch(0),_context2.t0 instanceof Error&&setError(_context2.t0.message);case 13:case"end":return _context2.stop()}}),_callee2,null,[[0,10]])})));return function addNewPost(){return _ref2.apply(this,arguments)}}();return(0,jsx_runtime.jsxs)("div",{children:[postsLayout,(0,jsx_runtime.jsx)("input",{value:newPostTitle,onChange:function onChange(e){return setNewPostTitle(e.target.value)},"data-testid":"myInput"}),(0,jsx_runtime.jsx)("button",{onClick:addNewPost,"data-testid":"button",children:"Add new post"}),error&&(0,jsx_runtime.jsx)("p",{children:error})]})},parameters:{msw:{handlers:handlers}},tags:["autodocs"]},Posts_stories=meta,Primary={play:(_play=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee3(_ref){var canvasElement,step,canvas,postsLength,afterPostsLength;return(0,regeneratorRuntime.Z)().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return canvasElement=_ref.canvasElement,step=_ref.step,canvas=(0,testing_library_dist.uh)(canvasElement),_context3.next=4,(0,testing_library_dist.X_)((function(){return(0,dist.l)(canvas.getAllByTestId("post").length).not.toBe(0)}));case 4:return postsLength=canvas.getAllByTestId("post").length,_context3.next=7,step("Enter title",(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(){return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,testing_library_dist.mV.type(canvas.getByTestId("myInput"),"dummy string");case 2:case"end":return _context.stop()}}),_callee)}))));case 7:return _context3.next=9,step("Submit",(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee2(){return(0,regeneratorRuntime.Z)().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,testing_library_dist.mV.click(canvas.getByTestId("button"));case 2:case"end":return _context2.stop()}}),_callee2)}))));case 9:return _context3.next=11,(0,testing_library_dist.X_)((function(){return(0,dist.l)(canvas.getAllByTestId("post").length).not.toBe(2)}));case 11:return afterPostsLength=canvas.getAllByTestId("post").length,_context3.next=14,(0,testing_library_dist.X_)((function(){return(0,dist.l)(afterPostsLength).toBeGreaterThan(postsLength)}));case 14:case"end":return _context3.stop()}}),_callee3)}))),function play(_x){return _play.apply(this,arguments)})};Primary.parameters=(0,objectSpread2.Z)((0,objectSpread2.Z)({},Primary.parameters),{},{docs:(0,objectSpread2.Z)((0,objectSpread2.Z)({},null===(_Primary$parameters=Primary.parameters)||void 0===_Primary$parameters?void 0:_Primary$parameters.docs),{},{source:(0,objectSpread2.Z)({originalSource:"{\n  play: async ({\n    canvasElement,\n    step\n  }) => {\n    const canvas = within(canvasElement);\n    await waitFor(() => expect(canvas.getAllByTestId('post').length).not.toBe(0));\n    const postsLength = canvas.getAllByTestId('post').length;\n    await step('Enter title', async () => {\n      await userEvent.type(canvas.getByTestId('myInput'), 'dummy string');\n    });\n    await step('Submit', async () => {\n      await userEvent.click(canvas.getByTestId('button'));\n    });\n    await waitFor(() => expect(canvas.getAllByTestId('post').length).not.toBe(2));\n    const afterPostsLength = canvas.getAllByTestId('post').length;\n    await waitFor(() => expect(afterPostsLength).toBeGreaterThan(postsLength));\n  }\n}"},null===(_Primary$parameters2=Primary.parameters)||void 0===_Primary$parameters2||null===(_Primary$parameters2$=_Primary$parameters2.docs)||void 0===_Primary$parameters2$?void 0:_Primary$parameters2$.source)})});var __namedExportsOrder=["Primary"]},"?4f7e":function(){}}]);